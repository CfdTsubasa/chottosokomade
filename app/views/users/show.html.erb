<% provide(:title, @user.name) %>
<div class="block pb-4 mx-32 mt-5 relative bg-white rounded-lg border border-gray-200 shadow-md dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700">
  <div class="mx-5">
    <div class="grid grid-cols-2 gap-5 flex items-center content-center">
      <div class="mt-3 mx-auto">
        <% if @user.image.present? %>
          <%= image_tag @user.image.url,:class=> 'icon-circle-mypage', :size => '500x500' %>
        <% else %>
          <%= image_tag 'user.svg', :size => '500x500' %>
        <% end %>
      </div>
      <div class="text-slate-600 mt-8">
        <div class="text-3xl font-semibold">
          <%= @user.name %>
        </div>
        <div class="flex gap-7 pt-5 text-2xl">
          <div class="flex flex-col">
            <span class="text-slate-600">Articles</span>
            <span class="font-semibold text-center"><%= @user.spots.count %></span>
          </div>
          <div class="flex flex-col">
            <span class="text-slate-600">Followers</span>
            <span class="font-semibold text-center"><%= @user.followers.count %></span>
          </div>
          <div class="flex flex-col">
            <span class="text-slate-600">Followings</span>
            <span class="font-semibold text-center"><%= @user.following.count %></span>
          </div>
        </div>
        <% if @user.current_location.present? %>
          <span class="text-green-500">現在位置登録済み</span>
        <% else %>
          <span>現在位置登録が未登録です</span>
        <% end %>
        <div class="mt-5 w-60 cursor-pointer">
          <button id="btn" class="btn px-5 py-3 border-2 text-center text-blue-500 rounded-md border-blue-500 ">
            現在位置を取得する
          </button>
          <div id="btn2" class="hidden">
            <span class="text-xl font-medium">取得に成功しました！</span>
            <button class="justify-center px-5 py-3 border-2 text-center text-green-500 rounded-md border-green-500">
              <div class="btn">
                <%= form_with(model:@current_location, local: true) do |f| %>
                  <%= f.hidden_field :latitude %>
                  <%= f.hidden_field :longitude %>
                  <%= f.submit "現在位置情報を保存する" %>
                <% end %>
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="tab_box border-gray-200 dark:border-gray-700">
      <ul class="btn_area flex flex-wrap justify-center mx-auto my-5 border-b text-sm font-medium text-center text-gray-500 dark:text-gray-400">
        <div class="tab_btn border-b-2 border-blue-600 active">
          <div class="inline-flex p-4 rounded-t-lg  text-blue-600 dark:text-blue-500 dark:border-blue-500">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="mr-2 w-5 h-5 text-blue-600 dark:text-blue-500">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
            </svg>
            投稿した記事
          </div>
        </div>
        <div class="tab_btn">
          <div class="inline-flex p-4 rounded-t-lg text-blue-600 dark:text-blue-500 dark:border-blue-500" aria-current="page">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="mr-2 w-5 h-5 text-blue-600 dark:text-blue-500">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
            </svg>
            お気に入り
          </div>
        </div>
      </ul>
      <div class="panel_area">
        <div class="tab_panel active">
          <% @spots.each do |spot| %>
            <%= link_to spot_path(spot) do %>
              <div class="grid grid-cols-7 mt-3 p-2 hover:bg-slate-100">
                <div class="col-span-2">
                  <% if spot.images[0].present? %>
                    <%= image_tag spot.images[0].url, class: "border rounded-md object-contain h-48 w-80 mx-auto", size: "30x30"%>
                  <% else %>
                    <%= image_tag "/assets/default.png", class: "border rounded-md object-cover h-48 w-80 mx-auto"%>
                  <% end %>
                </div>
                <div class="col-span-5 ml-5 relative mt-3 flex flex-col">
                  <p class="text-3xl font-semibold text-slate-600"><%= spot.name %></p>
                  <p class="text-xl font-semibold text-slate-600"><%= spot.comment %></p>
                  <div class="flex mt-5">
                    <svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="width: 25px; height: 25px; opacity: 1;" xml:space="preserve">
                      <style type="text/css">
                        .st0{fill:#4B4B4B;}
                      </style>
                      <g>
                        <path class="st0" d="M380.63,32.196C302.639,33.698,264.47,88.893,256,139.075c-8.47-50.182-46.638-105.378-124.63-106.879
                          C59.462,30.814,0,86.128,0,187.076c0,129.588,146.582,189.45,246.817,286.25c3.489,3.371,2.668,3.284,2.668,3.284
                          c1.647,2.031,4.014,3.208,6.504,3.208v0.011c0,0,0.006,0,0.011,0c0,0,0.006,0,0.011,0v-0.011c2.489,0,4.856-1.177,6.503-3.208
                          c0,0-0.821,0.086,2.669-3.284C365.418,376.526,512,316.664,512,187.076C512,86.128,452.538,30.814,380.63,32.196z" style="fill: rgb(223, 86, 86);">
                        </path>
                      </g>
                    </svg>
                    <p class="ml-2">: <%= spot.likes.count %></p>
                  </div>
                  <div class="flex pb-3 mt-3">
                    <%= link_to 'DELETE', "/spots/#{spot.id}", method: :delete,class: "px-3 py-1 mr-2 border hover:bg-gray-100 hover:white rounded-md", data: {confirm: "削除しますか？"} %>
                    <%= link_to 'EDIT', "/spots/#{spot.id}/edit", {class: "px-3 py-1 border hover:bg-gray-100 hover:white rounded-md"} %>
                  </div>
                  <p class="absolute text-xl text-end bottom-0 right-0 text-slate-600">作成日&nbsp;<%= spot.created_at.strftime('%Y/%m/%d %H:%M') %></p>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
        <div class="tab_panel">
          <% @user.liked_spots.each do |spot| %>
            <%= link_to spot_path(spot) do %>
              <div class="grid grid-cols-7 mt-3 p-2 hover:bg-slate-100">
                <div class="col-span-2">
                  <% if spot.images[0].present? %>
                    <%= image_tag spot.images[0].url, class: "border rounded-md object-contain h-48 w-80 mx-auto", size: "30x30"%>
                  <% else %>
                    <%= image_tag "/assets/default.png", class: "border rounded-md object-cover h-48 w-80 mx-auto"%>
                  <% end %>
                </div>
                <div class="col-span-5 ml-5 relative mt-3 flex flex-col">
                  <p class="text-3xl font-semibold text-slate-600"><%= spot.name %></p>
                  <p class="text-xl font-semibold text-slate-600"><%= spot.comment %></p>
                  <div class="flex mt-5">
                    <svg version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="width: 25px; height: 25px; opacity: 1;" xml:space="preserve">
                      <style type="text/css">
                        .st0{fill:#4B4B4B;}
                      </style>
                      <g>
                        <path class="st0" d="M380.63,32.196C302.639,33.698,264.47,88.893,256,139.075c-8.47-50.182-46.638-105.378-124.63-106.879
                          C59.462,30.814,0,86.128,0,187.076c0,129.588,146.582,189.45,246.817,286.25c3.489,3.371,2.668,3.284,2.668,3.284
                          c1.647,2.031,4.014,3.208,6.504,3.208v0.011c0,0,0.006,0,0.011,0c0,0,0.006,0,0.011,0v-0.011c2.489,0,4.856-1.177,6.503-3.208
                          c0,0-0.821,0.086,2.669-3.284C365.418,376.526,512,316.664,512,187.076C512,86.128,452.538,30.814,380.63,32.196z" style="fill: rgb(223, 86, 86);"></path>
                      </g>
                    </svg>
                    <p class="ml-2">: <%= spot.likes.count %></p>
                  </div>
                  <p class="absolute text-xl text-end bottom-0 right-0 text-slate-600">作成日&nbsp;<%= spot.created_at.strftime('%Y/%m/%d %H:%M') %></p>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $("#btn").click(function(){
    navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
  });

  function successCallback(position){
    let latitude = position.coords.latitude;
    $("#current_location_latitude").val(latitude);

    let longitude = position.coords.longitude;
    $("#current_location_longitude").val(longitude);

    $("#btn").addClass("hidden");
    $("#btn2").removeClass("hidden");
  };

  function errorCallback(error){
      alert("位置情報が取得できませんでした");
  };
  
  $('.tab_box .tab_btn').click(function() {
    var index = $('.tab_box .tab_btn').index(this);
    $('.tab_box .tab_btn, .tab_box .tab_panel').removeClass('active border-b-2 border-blue-600');
    $(this).addClass('active border-b-2 border-blue-600');
    $('.tab_box .tab_panel').eq(index).addClass('active');
  });
</script>
